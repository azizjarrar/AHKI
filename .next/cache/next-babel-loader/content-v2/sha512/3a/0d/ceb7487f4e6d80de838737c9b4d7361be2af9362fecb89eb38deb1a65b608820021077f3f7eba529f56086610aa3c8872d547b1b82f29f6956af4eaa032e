{"ast":null,"code":"import _regeneratorRuntime from \"F:/AHKI/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"F:/AHKI/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _defineProperty from \"F:/AHKI/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"F:/AHKI/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport '../styles/globals.scss';\nimport React from 'react';\nimport initLanguage from '../components/initLanguage/initLanguage';\nimport { GetUserData } from '../services/user';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport UserContext from '../context/userContext';\nimport LanguageContext from '../context/languageContext';\nimport SocketContext from '../context/socketContext';\nimport ApiIsLoadingContext from '../context/apiIsLoadingContext';\nimport { useRouter } from 'next/router';\nimport io from 'socket.io-client';\nimport ip from '../const';\n\nfunction MyApp(_ref) {\n  var Component = _ref.Component,\n      pageProps = _ref.pageProps;\n\n  var _React$useState = React.useState({\n    image: \"\",\n    tel: \"\",\n    biography: \"\",\n    userName: \"\",\n    firstname: \"\",\n    lastname: \"\",\n    age: \"\",\n    following: 0,\n    followers: 0\n  }),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      user = _React$useState2[0],\n      setUser = _React$useState2[1];\n\n  var userProvider = React.useMemo(function () {\n    return {\n      user: user,\n      setUser: setUser\n    }, [user, setUser];\n  });\n  /********************************************************************/\n\n  var _React$useState3 = React.useState(_objectSpread({}, initLanguage(\"eng\"))),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      language = _React$useState4[0],\n      setLanguage = _React$useState4[1];\n\n  var languageProvider = React.useMemo(function () {\n    return {\n      language: language,\n      setLanguage: setLanguage\n    }, [language, setLanguage];\n  });\n  /********************************************************************/\n\n  var _React$useState5 = React.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      isLoading = _React$useState6[0],\n      setIsLoading = _React$useState6[1];\n\n  var loadingProvider = React.useMemo(function () {\n    return {\n      isLoading: isLoading,\n      setIsLoading: setIsLoading\n    }, [isLoading, setIsLoading];\n  });\n  /********************************************************************/\n\n  var _React$useState7 = React.useState(undefined),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      socket = _React$useState8[0],\n      setSocket = _React$useState8[1];\n\n  var socketProvider = React.useMemo(function () {\n    return {\n      socket: socket,\n      setSocket: setSocket\n    }, [socket, setSocket];\n  });\n  /*****************************************************************/\n\n  var _React$useState9 = React.useState(false),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      onlyOnce = _React$useState10[0],\n      setonlyOnce = _React$useState10[1];\n\n  var router = useRouter();\n  var socketRef = React.useRef();\n  /*socket io*/\n\n  /************************************/\n\n  if (router.query.refrech == \"true\" && onlyOnce == false) {\n    setonlyOnce(true);\n    GetUserData(pageProps.token).then(function (data) {\n      setUser(function (e) {\n        return _objectSpread(_objectSpread(_objectSpread({}, e), data.data.data[0]), {}, {\n          token: pageProps.token\n        });\n      });\n    })[\"catch\"](function (e) {});\n  }\n\n  React.useEffect(function () {\n    /*****************init Token to userProvider******************/\n    setUser(function (e) {\n      return _objectSpread(_objectSpread({}, e), {}, {\n        token: pageProps.token\n      });\n    });\n    /*get current lang */\n\n    setLanguage(initLanguage(localStorage.getItem('language') || \"eng\"));\n    /***********************************************************/\n\n    /********************fetch user data online if there is token************************/\n\n    /***********************************************************/\n\n    if (pageProps.token) {\n      GetUserData(pageProps.token).then(function (data) {\n        socketRef.current = io(ip);\n        socketRef.current.on(\"getSocketid\", function (dataFromSocket) {\n          socketRef.current.emit(\"saveuserOnline\", {\n            userid: data.data.data[0]._id,\n            socketid: dataFromSocket\n          });\n          setSocket(socketRef.current);\n        });\n        setUser(function (e) {\n          return _objectSpread(_objectSpread({}, e), data.data.data[0]);\n        });\n      })[\"catch\"](function (e) {});\n    }\n  }, [router.query.refrech]);\n  /******************************************************************************************\r\n   *******************************************************************************************\r\n   ******************************************************************************************/\n\n  return /*#__PURE__*/_jsx(_Fragment, {\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \"appWrapper\",\n      children: /*#__PURE__*/_jsx(LanguageContext.Provider, {\n        value: languageProvider,\n        children: /*#__PURE__*/_jsx(UserContext.Provider, {\n          value: userProvider,\n          children: /*#__PURE__*/_jsx(ApiIsLoadingContext.Provider, {\n            value: loadingProvider,\n            children: /*#__PURE__*/_jsxs(SocketContext.Provider, {\n              value: socketProvider,\n              children: [isLoading && /*#__PURE__*/_jsx(\"div\", {\n                className: \"loading\",\n                children: /*#__PURE__*/_jsx(LinearProgress, {})\n              }), /*#__PURE__*/_jsx(Component, _objectSpread({}, pageProps))]\n            })\n          })\n        })\n      })\n    })\n  });\n}\n\nexport default MyApp;\nexport function getInitialProps(_x) {\n  return _getInitialProps.apply(this, arguments);\n}\n\nfunction _getInitialProps() {\n  _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2) {\n    var req, res;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            req = _ref2.req, res = _ref2.res;\n            _context.next = 3;\n            return req.cookies.token;\n\n          case 3:\n            if (!_context.sent) {\n              _context.next = 7;\n              break;\n            }\n\n            _context.t0 = {\n              props: {\n                token: true\n              }\n            };\n            _context.next = 8;\n            break;\n\n          case 7:\n            _context.t0 = {\n              redirect: {\n                destination: '/',\n                permanent: false\n              }\n            };\n\n          case 8:\n            return _context.abrupt(\"return\", _context.t0);\n\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _getInitialProps.apply(this, arguments);\n}","map":null,"metadata":{},"sourceType":"module"}