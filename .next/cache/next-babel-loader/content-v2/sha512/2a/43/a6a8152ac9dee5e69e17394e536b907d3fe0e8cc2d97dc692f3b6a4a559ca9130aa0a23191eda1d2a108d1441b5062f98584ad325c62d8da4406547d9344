{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"F:\\\\AHKI\\\\pages\\\\_app.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport '../styles/globals.scss';\nimport React from 'react';\nimport initLanguage from '../components/initLanguage/initLanguage';\nimport { GetUserData } from '../services/user';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport UserContext from '../context/userContext';\nimport LanguageContext from '../context/languageContext';\nimport SocketContext from '../context/socketContext';\nimport ApiIsLoadingContext from '../context/apiIsLoadingContext';\nimport { useRouter } from 'next/router';\nimport io from 'socket.io-client';\n\nfunction MyApp({\n  Component,\n  pageProps\n}) {\n  const [user, setUser] = React.useState({\n    image: \"\",\n    tel: \"\",\n    biography: \"\",\n    userName: \"\",\n    firstname: \"\",\n    lastname: \"\",\n    age: \"\",\n    following: 0,\n    followers: 0\n  });\n  const userProvider = React.useMemo(() => (({\n    user,\n    setUser\n  }), [user, setUser]));\n  /********************************************************************/\n\n  const [language, setLanguage] = React.useState(_objectSpread({}, initLanguage(\"eng\")));\n  const languageProvider = React.useMemo(() => (({\n    language,\n    setLanguage\n  }), [language, setLanguage]));\n  /********************************************************************/\n\n  const [isLoading, setIsLoading] = React.useState(false);\n  const loadingProvider = React.useMemo(() => (({\n    isLoading,\n    setIsLoading\n  }), [isLoading, setIsLoading]));\n  /********************************************************************/\n\n  const [socket, setSocket] = React.useState(undefined);\n  const socketProvider = React.useMemo(() => (({\n    socket,\n    setSocket\n  }), [socket, setSocket]));\n  /*****************************************************************/\n\n  const [onlyOnce, setonlyOnce] = React.useState(false);\n  const router = useRouter();\n  const socketRef = React.useRef();\n  /*socket io*/\n\n  /************************************/\n\n  if (router.query.refrech == \"true\" && onlyOnce == false) {\n    setonlyOnce(true);\n    GetUserData(pageProps.token).then(data => {\n      setUser(e => {\n        return _objectSpread(_objectSpread(_objectSpread({}, e), data.data.data[0]), {}, {\n          token: pageProps.token\n        });\n      });\n    }).catch(e => {});\n  }\n\n  React.useEffect(() => {\n    /*****************init Token to userProvider******************/\n    setUser(e => {\n      return _objectSpread(_objectSpread({}, e), {}, {\n        token: pageProps.token\n      });\n    });\n    /*get current lang */\n\n    setLanguage(initLanguage(localStorage.getItem('language') || \"eng\"));\n    /***********************************************************/\n\n    /********************fetch user data online if there is token************************/\n\n    /***********************************************************/\n\n    if (pageProps.token) {\n      GetUserData(pageProps.token).then(data => {\n        socketRef.current = io(\"http://127.0.0.1:5010\");\n        socketRef.current.on(\"getSocketid\", dataFromSocket => {\n          socketRef.current.emit(\"saveuserOnline\", {\n            userid: data.data.data[0]._id,\n            socketid: dataFromSocket\n          });\n          setSocket(socketRef.current);\n        });\n        setUser(e => {\n          return _objectSpread(_objectSpread({}, e), data.data.data[0]);\n        });\n      }).catch(e => {});\n    }\n  }, [router.query.refrech]);\n  /******************************************************************************************\r\n   *******************************************************************************************\r\n   ******************************************************************************************/\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"appWrapper\",\n      children: /*#__PURE__*/_jsxDEV(LanguageContext.Provider, {\n        value: languageProvider,\n        children: /*#__PURE__*/_jsxDEV(UserContext.Provider, {\n          value: userProvider,\n          children: /*#__PURE__*/_jsxDEV(ApiIsLoadingContext.Provider, {\n            value: loadingProvider,\n            children: /*#__PURE__*/_jsxDEV(SocketContext.Provider, {\n              value: socketProvider,\n              children: [isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"loading\",\n                children: /*#__PURE__*/_jsxDEV(LinearProgress, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 83,\n                  columnNumber: 52\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 83,\n                columnNumber: 27\n              }, this), /*#__PURE__*/_jsxDEV(Component, _objectSpread({}, pageProps), void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 84,\n                columnNumber: 15\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 82,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n}\n\nexport default MyApp;\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  console.log(req);\n  return (await req.cookies.token) ? {\n    props: {\n      token: true\n    }\n  } : {\n    redirect: {\n      destination: '/',\n      permanent: false\n    }\n  };\n}","map":{"version":3,"sources":["F:/AHKI/pages/_app.js"],"names":["React","initLanguage","GetUserData","LinearProgress","UserContext","LanguageContext","SocketContext","ApiIsLoadingContext","useRouter","io","MyApp","Component","pageProps","user","setUser","useState","image","tel","biography","userName","firstname","lastname","age","following","followers","userProvider","useMemo","language","setLanguage","languageProvider","isLoading","setIsLoading","loadingProvider","socket","setSocket","undefined","socketProvider","onlyOnce","setonlyOnce","router","socketRef","useRef","query","refrech","token","then","data","e","catch","useEffect","localStorage","getItem","current","on","dataFromSocket","emit","userid","_id","socketid","getServerSideProps","req","res","console","log","cookies","props","redirect","destination","permanent"],"mappings":"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","sourcesContent":["import '../styles/globals.scss'\r\nimport React from 'react'\r\nimport initLanguage from '../components/initLanguage/initLanguage'\r\nimport { GetUserData } from '../services/user'\r\nimport LinearProgress from '@material-ui/core/LinearProgress';\r\nimport UserContext from '../context/userContext'\r\nimport LanguageContext from '../context/languageContext'\r\nimport SocketContext from '../context/socketContext'\r\nimport ApiIsLoadingContext from '../context/apiIsLoadingContext'\r\nimport { useRouter } from 'next/router'\r\nimport io from 'socket.io-client';\r\n\r\n\r\n\r\nfunction MyApp({ Component, pageProps }) {\r\n  const [user, setUser] = React.useState({image:\"\",tel:\"\",biography:\"\",userName:\"\",firstname:\"\",lastname:\"\",age:\"\",following:0,followers:0})\r\n  const userProvider = React.useMemo(() => ({ user, setUser }, [user, setUser]))\r\n  /********************************************************************/\r\n  const [language, setLanguage] = React.useState({ ...initLanguage(\"eng\") })\r\n  const languageProvider = React.useMemo(() => ({ language, setLanguage }, [language, setLanguage]))\r\n  /********************************************************************/\r\n  const [isLoading, setIsLoading] = React.useState(false)\r\n  const loadingProvider = React.useMemo(() => ({ isLoading, setIsLoading }, [isLoading, setIsLoading]))\r\n  /********************************************************************/\r\n  const [socket, setSocket] = React.useState(undefined)\r\n  const socketProvider = React.useMemo(() => ({ socket, setSocket}, [socket, setSocket]))\r\n  /*****************************************************************/\r\n  const [onlyOnce,setonlyOnce]=React.useState(false)\r\n  const router = useRouter()\r\n  const socketRef = React.useRef()\r\n\r\n/*socket io*/\r\n\r\n  /************************************/ \r\n  if(router.query.refrech==\"true\" && onlyOnce==false){\r\n    setonlyOnce(true)\r\n    GetUserData(pageProps.token).then(data => { \r\n      \r\n      setUser(e => { return { ...e, ...data.data.data[0],token: pageProps.token } })\r\n\r\n     }).catch(e => { })\r\n\r\n  }\r\n\r\n  React.useEffect(() => {\r\n   \r\n\r\n    /*****************init Token to userProvider******************/\r\n    setUser(e => { return { ...e, token: pageProps.token } })\r\n    /*get current lang */\r\n    setLanguage(initLanguage(localStorage.getItem('language') || \"eng\"))\r\n\r\n\r\n    /***********************************************************/\r\n    /********************fetch user data online if there is token************************/\r\n    /***********************************************************/\r\n    \r\n    if (pageProps.token) {\r\n      GetUserData(pageProps.token).then(data => { \r\n        socketRef.current =io(\"http://127.0.0.1:5010\");\r\n        socketRef.current.on(\"getSocketid\",(dataFromSocket)=>{\r\n        socketRef.current.emit(\"saveuserOnline\",{userid:data.data.data[0]._id,socketid:dataFromSocket})\r\n        setSocket(socketRef.current)\r\n        })\r\n        setUser(e => { \r\n        return { ...e, ...data.data.data[0] } \r\n      }) \r\n      }).catch(e => { })\r\n    }\r\n  }, [router.query.refrech])\r\n\r\n  \r\n  /******************************************************************************************\r\n   *******************************************************************************************\r\n   ******************************************************************************************/\r\n  return (\r\n    <>\r\n      <div className='appWrapper'>\r\n        <LanguageContext.Provider value={languageProvider}>\r\n          <UserContext.Provider value={userProvider} >\r\n            <ApiIsLoadingContext.Provider value={loadingProvider}>\r\n              <SocketContext.Provider value={socketProvider}>\r\n              {isLoading&&<div className=\"loading\"><LinearProgress /></div>}\r\n              <Component {...pageProps} />\r\n              </SocketContext.Provider>\r\n            </ApiIsLoadingContext.Provider>\r\n          </UserContext.Provider>\r\n        </LanguageContext.Provider>\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default MyApp\r\nexport async function getServerSideProps({ req, res }) {\r\n  console.log(req)\r\n  return await req.cookies.token ? { props: { token: true } } : { redirect: { destination: '/', permanent: false, } }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}