{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport Style from './biggerImagewithcomments.module.scss';\nimport { getImageData } from '../../services/images';\nimport Heart from '../../components/heart/heart';\nimport userContext from '../../context/userContext';\nimport { Picker, Emoji } from 'emoji-mart';\nimport 'emoji-mart/css/emoji-mart.css';\nimport LanguageContext from '../../context/languageContext';\nimport { addCommentToImage, getCommentsImage, countComments } from '../../services/imageComments';\nimport { countImageLikes } from '../../services/imageLikes';\nimport { deleteImage } from '../../services/images';\nimport Comment from '../comment/comment';\nimport ShowLikesUserNames from '../showLikesUserNames/showLikesUserNames';\nimport PopUpMessage from '../../components/popUpMessage/popUpMessage';\n\nconst biggerImagewithcomments = props => {\n  const [currentimage, setCurrentimage] = React.useState({}); // has the data of the current image\n\n  const [nextimage, setNextimage] = React.useState(); // has id of next image\n\n  const [previmage, setPrevimage] = React.useState(); //has id fo prev image\n\n  const [comments, setComments] = React.useState(false); //open or close comments\n\n  const [imageLoading, setimageLoading] = React.useState(false);\n  const [likesNumber, setLikesNumber] = React.useState(0);\n  const [coummentNumber, setCoummentNumber] = React.useState(0);\n  const [setOwnerOfImageData, setSetOwnerOfImageData] = React.useState({\n    userData: {\n      currentImageUrl: \"\",\n      userName: \"\"\n    }\n  });\n  const [user, setUser] = React.useContext(userContext); //user data\n\n  const [textAreaData, setTextAreaData] = React.useState(\"\"); // text area for add comment\n\n  const [countLettres, setCountLettres] = React.useState(0); // count how many lettre in text area\n\n  const [closeOrOpenEmojiPickerState, setcloseOrOpenEmojiPickerState] = React.useState(false); //emoji handler\n\n  const [language, setLanguage] = React.useContext(LanguageContext);\n  const [skip, setSkip] = React.useState(0); //fetch data with skip\n\n  const [commentsData, setCommentsData] = React.useState([]); //comments Container\n\n  const [addsOneToCommentCount, setaddOneToCommentCount] = React.useState(0); //when add comment automaticly add + to old one\n\n  const [moreComments, setMoreComments] = React.useState(false); //show more comment fetch  with 3 by 3\n\n  const [likesModal, setLikesModal] = React.useState(false); // show modal has all the name of who put like\n\n  const [settings, setSettings] = React.useState({\n    state: false,\n    firstClick: false\n  }); //show settings on click on 3 dots ...\n\n  /*************************************************************/\n\n  /*********************use effects*****************************/\n\n  /*************************************************************/\n\n  React.useState(() => {\n    /*he i fetch cureent img data and the next and prev image id */\n    setimageLoading(true);\n    getImageData({\n      currentImgId: props.imgid,\n      userid: props.userid\n    }, props.token).then(result => {\n      setimageLoading(false);\n      setSetOwnerOfImageData(result.data);\n      setCurrentimage(e => {\n        return _objectSpread({}, result.data.currentimage);\n      });\n      setNextimage(e => {\n        return _objectSpread({}, result.data.nextimage);\n      });\n      setPrevimage(e => {\n        return _objectSpread({}, result.data.previmage);\n      });\n    }).catch(error => {\n      console.log(error);\n    });\n  }, []);\n  /*calc textArea length */\n\n  React.useEffect(() => {\n    setCountLettres(textAreaData.length);\n  }, [textAreaData]); //when i change image fetch ne data of the current image\n\n  React.useEffect(() => {\n    setCommentsData([]);\n    setSkip(0);\n    setComments(false);\n    countImageLikes({\n      imageid: currentimage._id || props.imgid\n    }, props.token).then(result => {\n      setLikesNumber(result.data.count);\n    }).catch(error => {\n      console.log(error);\n    });\n\n    if (currentimage._id != undefined) {\n      getCommentsImage({\n        imageid: currentimage._id || props.imgid,\n        skip: 0\n      }, user.token).then(result => {\n        setComments(true);\n\n        if (result.data.data.length > 0) {\n          setMoreComments(true);\n        } else {\n          setMoreComments(false);\n        }\n\n        setCommentsData(e => [...e, ...result.data.data]);\n      }).catch(error => {\n        alert(error);\n      });\n      countComments({\n        imageid: currentimage._id || props.imgid,\n        skip: 0\n      }, user.token).then(result => {\n        setCoummentNumber(result.data.count);\n      }).catch(error => {\n        alert(error);\n      });\n    }\n  }, [currentimage._id]); //hedhi kenet t3awed tfetchi\n  //when i click load more comments get 3 new comment evry time\n\n  React.useEffect(() => {\n    if (skip != 0) {\n      getCommentsImage({\n        imageid: currentimage._id || props.imgid,\n        skip: skip\n      }, user.token).then(result => {\n        if (result.data.data.length > 0) {\n          setMoreComments(true);\n        } else {\n          setMoreComments(false);\n        }\n\n        setCommentsData(e => [...e, ...result.data.data]);\n      }).catch(error => {\n        alert(error);\n      });\n    }\n  }, [skip]);\n\n  const LoadMoreComments = () => {\n    setSkip(e => e + 3);\n  };\n  /* go to prev image */\n\n\n  const goPrev = () => {\n    setimageLoading(true);\n    getImageData({\n      currentImgId: previmage._id,\n      userid: props.userid\n    }, props.token).then(result => {\n      setimageLoading(false);\n      setCurrentimage(e => {\n        return _objectSpread(_objectSpread({}, e), result.data.currentimage);\n      });\n      setNextimage(e => {\n        return _objectSpread({}, result.data.nextimage);\n      });\n      setPrevimage(e => {\n        return _objectSpread({}, result.data.previmage);\n      });\n    }).catch(error => {\n      console.log(error);\n    });\n  }; // go to next image\n\n\n  const gonext = () => {\n    setimageLoading(true);\n    getImageData({\n      currentImgId: nextimage._id,\n      userid: props.userid\n    }, props.token).then(result => {\n      setimageLoading(false);\n      setCurrentimage(e => {\n        return _objectSpread(_objectSpread({}, e), result.data.currentimage);\n      });\n      setNextimage(e => {\n        return _objectSpread({}, result.data.nextimage);\n      });\n      setPrevimage(e => {\n        return _objectSpread({}, result.data.previmage);\n      });\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n  /* set the height of text area and when text get bigger textarea get biiger with it */\n\n\n  const textAreaHolder = e => {\n    e.target.style.height = \"16px\";\n    e.target.style.height = e.target.scrollHeight + \"px\"; //only take 200 char\n\n    setTextAreaData(el => {\n      if (el.length <= 200) {\n        return e.target.value;\n      } else {\n        return el.slice(0, 200);\n      }\n    });\n  };\n  /* close emoji comp */\n\n\n  const closeOrOpenEmojiPicker = () => {\n    setcloseOrOpenEmojiPickerState(e => !e);\n  }; //add commnent\n\n\n  const AddComment = () => {\n    addCommentToImage({\n      imageid: currentimage._id,\n      commentText: textAreaData\n    }, user.token).then(result => {\n      setCommentsData(e => [_objectSpread(_objectSpread({}, result.data.data), {}, {\n        commentOwner: {\n          userName: user.userName,\n          currentImageUrl: user.currentImageUrl,\n          _id: user._id\n        }\n      }), ...e]);\n      setComments(true);\n      setaddOneToCommentCount(e => e + 1);\n      setTextAreaData(\"\");\n    }).catch(error => {\n      console.log(error);\n    });\n  }; //add emojo to textarea\n\n\n  const addEmoji = e => {\n    let sym = e.unified.split('-');\n    let codesArray = [];\n    sym.forEach(el => codesArray.push('0x' + el));\n    let emoji = String.fromCodePoint(...codesArray);\n    setTextAreaData(el => {\n      if (el.length <= 200) {\n        return el + emoji;\n      } else {\n        return el.slice(0, 200);\n      }\n    });\n  }; // open or close comments\n\n\n  const openComments = () => {\n    setComments(e => !e);\n  }; //when you like image it will add in time to numbers of likes\n\n\n  const addLikeInTime = newLikesNumber => {\n    setLikesNumber(e => e + newLikesNumber);\n  }; // show usernames of people who liked image\n\n\n  const openshowLikesUserNames = () => {\n    setLikesModal(e => !e);\n  }; //show settings delete report \n\n\n  const ShowSettings = () => {\n    if (settings.firstClick != true) {\n      setSettings({\n        state: true,\n        firstClick: true\n      });\n    }\n  }; // close settings componnent\n\n\n  const closeComponenet = () => {\n    setSettings({\n      state: false,\n      firstClick: false\n    });\n  };\n\n  const deleteCommentInCurrentTimefn = commentIdDeleted => {\n    setCommentsData(arrayOfComment => {\n      return [...arrayOfComment.filter(e => {\n        return e._id != commentIdDeleted;\n      })];\n    });\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: Style.container,\n    children: [likesModal && /*#__PURE__*/_jsx(ShowLikesUserNames, {\n      closepopUp: openshowLikesUserNames,\n      imgid: currentimage._id || props.imgid\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: Style.closeBtn,\n      onClick: () => props.close()\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: Style.imageContainer,\n      children: [imageLoading && /*#__PURE__*/_jsx(\"div\", {\n        className: Style.loadingAnimation,\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: Style.ldsring,\n          children: [/*#__PURE__*/_jsx(\"div\", {}), /*#__PURE__*/_jsx(\"div\", {}), /*#__PURE__*/_jsx(\"div\", {}), /*#__PURE__*/_jsx(\"div\", {})]\n        })\n      }), /*#__PURE__*/_jsx(\"img\", {\n        src: currentimage.imageUrl || \"\"\n      }), previmage != undefined && previmage._id != undefined && /*#__PURE__*/_jsx(\"div\", {\n        className: `${Style.SwitchImage} ${Style.left}`,\n        onClick: () => goPrev(),\n        children: /*#__PURE__*/_jsx(\"span\", {\n          children: \"\\u2039\"\n        })\n      }), nextimage != undefined && nextimage._id != undefined && /*#__PURE__*/_jsx(\"div\", {\n        className: `${Style.SwitchImage} ${Style.Right}`,\n        onClick: () => gonext(),\n        children: /*#__PURE__*/_jsx(\"span\", {\n          children: \"\\u203A\"\n        })\n      })]\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: Style.commentsContainer,\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: Style.imageOwnerAndNameAndDateAndParams,\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: Style.imageContainerForUserCommentsSection,\n          children: /*#__PURE__*/_jsx(\"img\", {\n            src: setOwnerOfImageData.userData.currentImageUrl\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: Style.UserNameAndDate,\n          children: [/*#__PURE__*/_jsx(\"p\", {\n            children: setOwnerOfImageData.userData.userName\n          }), currentimage.date != undefined && /*#__PURE__*/_jsxs(\"p\", {\n            children: [currentimage.date.slice(0, 10), \" \", currentimage.date.slice(11, 16)]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: Style.Params,\n          onClick: () => ShowSettings(\"firstClick\"),\n          children: [settings.state == true && /*#__PURE__*/_jsx(SettingsImage, {\n            previmage: previmage,\n            closeComponenetfn: closeComponenet,\n            userImageid: currentimage._id || props.imgid,\n            currentUserId: user._id,\n            ownerid: setOwnerOfImageData.currentimage.ImageOwner._id,\n            token: user.token\n          }), \"\\u2026\"]\n        })]\n      }), currentimage.imageText != undefined && /*#__PURE__*/_jsx(\"div\", {\n        className: Style.bio,\n        children: /*#__PURE__*/_jsx(\"p\", {\n          children: currentimage.imageText\n        })\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: Style.LikesAndCommentsContainer,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: Style.Comments,\n          onClick: () => {\n            openComments();\n          },\n          children: [/*#__PURE__*/_jsx(\"svg\", {\n            width: \"69\",\n            height: \"69\",\n            viewBox: \"0 0 69 69\",\n            fill: \"none\",\n            xmlns: \"http://www.w3.org/2000/svg\",\n            children: /*#__PURE__*/_jsx(\"path\", {\n              d: \"M49.8333 24.6429C49.8333 11.0277 38.6807 0 24.9167 0C11.1526 0 0 11.0277 0 24.6429C0 29.9257 1.68906 34.7926 4.55208 38.8125C2.94688 43.4638 0.299479 47.1603 0.263542 47.2065C0 47.5607 -0.071875 48.0844 0.0838542 48.5464C0.239583 49.0085 0.575 49.2857 0.958333 49.2857C5.34271 49.2857 8.97239 47.3913 11.5839 45.4353C15.4411 47.8533 20.0052 49.2857 24.9167 49.2857C38.6807 49.2857 49.8333 38.258 49.8333 24.6429ZM64.4479 58.5268C67.3109 54.5223 69 49.64 69 44.3571C69 34.0533 62.5911 25.2281 53.5109 21.5471C53.6188 22.5636 53.6667 23.5955 53.6667 24.6429C53.6667 40.9533 40.7651 54.2143 24.9167 54.2143C23.6229 54.2143 22.3651 54.0911 21.1193 53.9216C24.8927 62.7777 33.7573 69 44.0833 69C48.9948 69 53.5589 67.583 57.4161 65.1496C60.0276 67.1056 63.6573 69 68.0417 69C68.425 69 68.7724 68.7074 68.9161 68.2607C69.0719 67.8141 69 67.2904 68.7365 66.9208C68.7005 66.8745 66.0531 63.1935 64.4479 58.5268Z\",\n              fill: \"#212121\"\n            })\n          }), /*#__PURE__*/_jsx(\"p\", {\n            className: Style.CommentsNumber,\n            children: coummentNumber + addsOneToCommentCount\n          }, \"unha\")]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: Style.likes,\n          children: [/*#__PURE__*/_jsx(Heart, {\n            addLikeInTime: e => addLikeInTime(e),\n            imgid: currentimage._id || props.imgid,\n            token: props.token\n          }), /*#__PURE__*/_jsx(\"p\", {\n            className: Style.likesNumber,\n            onClick: () => openshowLikesUserNames(),\n            children: likesNumber\n          })]\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: Style.userAddComments,\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: Style.userImageInComments,\n          children: /*#__PURE__*/_jsx(\"img\", {\n            src: user.currentImageUrl || \"/avatar.png\"\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: Style.textAreaContainer,\n          children: [/*#__PURE__*/_jsx(\"textarea\", {\n            placeholder: \"say somthing\",\n            onChange: e => textAreaHolder(e),\n            value: textAreaData,\n            className: Style.textArea\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: Style.countLettres,\n            children: /*#__PURE__*/_jsxs(\"span\", {\n              className: Style.countLettresCss,\n              style: countLettres >= 200 ? {\n                color: \"red\"\n              } : {},\n              children: [countLettres, \" : 200\"]\n            })\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: Style.emojiAndMaskAndPost,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: Style.openOrCloseEmojiPicker,\n            onClick: () => closeOrOpenEmojiPicker(),\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: Style.emojiLogo,\n              children: /*#__PURE__*/_jsx(Emoji, {\n                emoji: {\n                  id: 'smiling_face_with_3_hearts',\n                  skin: 3\n                },\n                size: 24\n              })\n            }), closeOrOpenEmojiPickerState && /*#__PURE__*/_jsx(\"div\", {\n              className: Style.emojiPickerContainer,\n              children: /*#__PURE__*/_jsx(Picker, {\n                perLine: 8,\n                onSelect: e => addEmoji(e)\n              })\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: Style.postAndCounterContainer,\n            children: /*#__PURE__*/_jsx(\"span\", {\n              className: Style.postText,\n              onClick: () => {\n                AddComment();\n              },\n              children: /*#__PURE__*/_jsx(SentSvg, {})\n            })\n          })]\n        })]\n      }), comments && /*#__PURE__*/_jsxs(\"div\", {\n        className: Style.commentsData,\n        children: [commentsData.map(e => {\n          return /*#__PURE__*/_jsx(Comment, {\n            currentUserId: user._id,\n            ownerid: e.commentOwner,\n            deleteCommentInCurrentTime: deleteCommentInCurrentTimefn,\n            imgid: currentimage._id || props.imgid,\n            token: user.token,\n            date: e.date,\n            commentid: e._id,\n            text: e.commentText,\n            name: e.commentOwner.userName,\n            userProfileImageUrl: e.commentOwner.currentImageUrl\n          }, e._id);\n        }), moreComments && /*#__PURE__*/_jsx(\"div\", {\n          className: Style.loadMoreComments,\n          onClick: () => LoadMoreComments(),\n          children: /*#__PURE__*/_jsx(\"p\", {\n            children: \"View more comments\"\n          })\n        })]\n      })]\n    })]\n  });\n};\n\nexport default biggerImagewithcomments;\n\nconst SentSvg = () => {\n  return /*#__PURE__*/_jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 64 64\",\n    children: /*#__PURE__*/_jsxs(\"g\", {\n      id: \"Layer_95\",\n      \"data-name\": \"Layer 95\",\n      children: [/*#__PURE__*/_jsx(\"path\", {\n        d: \"M53.06,10.94a1.5,1.5,0,0,0-1.53-.36l-40,13.33a1.51,1.51,0,0,0-.06,2.83l18.7,7.09,7.09,18.7a1.51,1.51,0,0,0,1.44,1,1.49,1.49,0,0,0,1.39-1l13.33-40A1.5,1.5,0,0,0,53.06,10.94Z\"\n      }), /*#__PURE__*/_jsx(\"path\", {\n        d: \"M20.22,35.48a1.5,1.5,0,0,0-2.12-2.12l-4.48,4.48a1.51,1.51,0,0,0,0,2.12,1.49,1.49,0,0,0,2.12,0Z\"\n      }), /*#__PURE__*/_jsx(\"path\", {\n        d: \"M23.88,40.12a1.49,1.49,0,0,0-2.12,0L16.08,45.8a1.5,1.5,0,0,0,2.12,2.12l5.68-5.68A1.49,1.49,0,0,0,23.88,40.12Z\"\n      }), /*#__PURE__*/_jsx(\"path\", {\n        d: \"M28.52,43.78,24,48.26a1.5,1.5,0,0,0,2.12,2.12l4.48-4.48A1.5,1.5,0,0,0,28.52,43.78Z\"\n      })]\n    })\n  });\n}; // this is the comp of image settings\n\n\nconst SettingsImage = props => {\n  // error handler\n  const [errorMessage, setErrorMessage] = React.useState({\n    state: false,\n    text: \"\"\n  }); // when state true show  pop up \n\n  const deleteImageFn = () => {\n    deleteImage({\n      imageid: props.userImageid,\n      previmage: props.previmage\n    }, props.token).then(result => {\n      if (result.data.state == true) {\n        //if you have only one image you cant deleted\n        setErrorMessage(e => {\n          return _objectSpread(_objectSpread({}, e), {}, {\n            state: true,\n            text: \"you should at least have one image\"\n          });\n        });\n      } else {\n        location.reload();\n      } //location.reload();\n\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n\n  const closePopUp = () => {\n    setErrorMessage({\n      state: false,\n      text: \"\"\n    });\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: Style.containerSettings,\n    children: [errorMessage.state == true && /*#__PURE__*/_jsx(PopUpMessage, {\n      fnclose: () => closePopUp(),\n      openPopUp: errorMessage\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: Style.paramsContainer,\n      children: /*#__PURE__*/_jsx(\"h3\", {\n        children: \"Report\"\n      })\n    }), props.ownerid == props.currentUserId && /*#__PURE__*/_jsx(\"div\", {\n      className: Style.paramsContainer,\n      onClick: () => deleteImageFn(),\n      children: /*#__PURE__*/_jsx(\"h3\", {\n        children: \"Delete\"\n      })\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: Style.paramsContainer,\n      onClick: () => props.closeComponenetfn(),\n      children: /*#__PURE__*/_jsx(\"h3\", {\n        children: \"Close\"\n      })\n    })]\n  });\n};","map":null,"metadata":{},"sourceType":"module"}